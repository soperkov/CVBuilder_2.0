@* CvClassic.razor — PDF template *@
@using CVBuilder.Core.Models

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>CvClassic</title>
    <style>
        @@page { size: A4; margin: 0; }

        :root {
          --navy:#1a2a47;
          --light:#f7f7f7;
          --text:#333;
          --muted:#777;
          --accent:#4caf50;
        }

        html,body{ height:100%; }
        body{
          margin:0;
          background:#fff;
          color:var(--text);
          font-family: "Inter", Arial, sans-serif;
        }

        .page{
          width:210mm; height:297mm;
          display:flex; align-items:stretch; justify-content:center;
        }

        .cv{
          display:grid;
          grid-template-columns: 34% 66%;
          width: 190mm; height: 277mm;  /* malo unutarnjeg ruba */
          margin:auto;
          border-radius:10px;
          overflow:hidden;
          box-shadow: 0 2px 6px rgba(0,0,0,.06);
        }

        .sidebar{
          background:var(--navy);
          color:#fff;
          padding:18mm 12mm;
        }
        .main{
          background:var(--light);
          padding:18mm 16mm;
        }

        .photo{
          width:48mm; height:48mm;
          margin:0 auto 10mm;
          border-radius:50%;
          border:3px solid #fff;
          overflow:hidden;
          display:flex; align-items:center; justify-content:center;
          box-shadow: 0 2px 5px rgba(0,0,0,.2);
          background:#5a6e8f;
        }
        .photo img{ width:100%; height:100%; object-fit:cover; display:block; }
        .photo .ph{ color:#fff; font-size:22px; }

        h1{
          margin:0 0 2mm 0;
          font-size:14mm; line-height:1.1; letter-spacing:.4mm;
          color:var(--navy); text-transform:uppercase; text-align:center;
        }
        .title{
          margin:0 auto 12mm; text-align:center; color:var(--muted);
          font-size:4.3mm;
        }

        h4{
          margin:10mm 0 4mm; padding-bottom:2mm;
          font-size:4.6mm; font-weight:700; text-transform:uppercase;
        }
        .sidebar h4{ border-bottom:2px solid rgba(255,255,255,.2); color:#e7ecf6; }
        .main h4{ border-bottom:2px solid #d9dee5; color:#2c3e50; }

        .kv{ margin:0 0 3mm; }
        .kv b{ display:block; color:#c8d3ea; font-size:3.7mm; }
        .kv span, .kv a{ color:#fff; font-size:3.8mm; text-decoration:none; }
        .kv a{ word-break:break-all; }

        .list{ list-style:none; padding:0; margin:0; }
        .list li{ margin:2.2mm 0; font-size:3.9mm; line-height:1.35; }

        .pill{
          background:#fff; color:var(--navy);
          display:inline-block; padding:1.2mm 3mm; border-radius:999px;
          font-weight:600; margin:1mm 2mm 0 0; font-size:3.6mm;
        }

        .card{
          background:#fff; border-left:4px solid var(--accent);
          border-radius:4px; padding:4mm 5mm; margin:4mm 0;
          box-shadow: 0 1px 3px rgba(0,0,0,.06);
        }
        .card .when{ color:var(--muted); font-size:3.6mm; }
        .card .who{ font-weight:700; color:var(--navy); font-size:4mm; margin-bottom:1mm; }

        .section-gap{ margin-top:8mm; }

        /* sitno */
        .muted { color:var(--muted); }
        .hidden { display:none; }
    </style>
</head>
<body>
  <div class="page">
    <div class="cv">

      <!-- LEFT -->
      <aside class="sidebar">
        <div class="photo">
          @if (!string.IsNullOrWhiteSpace(Model?.PhotoUrl))
          {
              <img src="@Model!.PhotoUrl" alt="Profile Photo" />
          }
          else
          {
              <span class="ph">👤</span>
          }
        </div>

        @* CONTACT *@
        @if (!string.IsNullOrWhiteSpace(Model?.PhoneNumber)
           || !string.IsNullOrWhiteSpace(Model?.Email)
           || !string.IsNullOrWhiteSpace(Model?.Address)
           || !string.IsNullOrWhiteSpace(Model?.WebPage))
        {
            <h4>Contact</h4>

            @if (!string.IsNullOrWhiteSpace(Model?.PhoneNumber))
            { <p class="kv"><b>Phone</b><span>@Model!.PhoneNumber</span></p> }

            @if (!string.IsNullOrWhiteSpace(Model?.Email))
            { <p class="kv"><b>Email</b><span>@Model!.Email</span></p> }

            @if (!string.IsNullOrWhiteSpace(Model?.Address))
            { <p class="kv"><b>Address</b><span>@Model!.Address</span></p> }

            @if (!string.IsNullOrWhiteSpace(Model?.WebPage))
            { <p class="kv"><b>Web</b><a href="@Model!.WebPage">@Model!.WebPage</a></p> }
        }

        @* SKILLS *@
        @if (Model?.Skills is { Count: > 0 })
        {
            <h4 class="section-gap">Skills</h4>
            <ul class="list">
              @foreach (var s in Model!.Skills) { <li>• @s.Name</li> }
            </ul>
        }

        @* LANGUAGES *@
        @if (Model?.Language is { Count: > 0 })
        {
            <h4 class="section-gap">Languages</h4>
            <ul class="list">
                @foreach (var l in Model!.Language)
                {
                    <li>
                        <span class="pill">
                            @((object)(l.Language?.Name ?? $"Language #{l.LanguageId}"))
                        </span>
                        <span class="muted"> @l.Level </span>
                    </li>
                }
            </ul>
        }
      </aside>

      <!-- RIGHT -->
      <main class="main">
        <h1>@Model?.FullName</h1>
        @if (!string.IsNullOrWhiteSpace(Model?.JobTitle))
        { <div class="title">@Model!.JobTitle</div> }

        @if (!string.IsNullOrWhiteSpace(Model?.AboutMe))
        {
            <h4>Profile</h4>
            <p style="margin:4mm 0 0; font-size:4mm;">@Model!.AboutMe</p>
        }

        @* WORK *@
        @if (Model?.Employment is { Count: > 0 })
        {
            <h4 class="section-gap">Work Experience</h4>
            @foreach (var emp in Model!.Employment)
            {
                <div class="card">
                    <div class="who">@emp.CompanyName</div>
                    <div class="when">
                        @emp.From.ToString("MMM yyyy") – @(emp.IsCurrent ? "Present" : emp.To?.ToString("MMM yyyy"))
                    </div>
                    @if (!string.IsNullOrWhiteSpace(emp.Description))
                    { <div style="margin-top:2mm">@emp.Description</div> }
                </div>
            }
        }

        @* EDUCATION *@
        @if (Model?.Education is { Count: > 0 })
        {
            <h4 class="section-gap">Education</h4>
            @foreach (var edu in Model!.Education)
            {
                <div class="card">
                    <div class="who">@edu.InstitutionName</div>
                    <div class="when">
                        @edu.From.ToString("MMM yyyy") – @(edu.IsCurrent ? "Present" : edu.To?.ToString("MMM yyyy"))
                    </div>
                    @if (!string.IsNullOrWhiteSpace(edu.Description))
                    { <div style="margin-top:2mm">@edu.Description</div> }
                </div>
            }
        }
      </main>

    </div>
  </div>
</body>
</html>

@code {
    [Parameter] public CVModel Model { get; set; } = new();

    private MarkupString FormatStackTraceLine(string line)
    {
        return new MarkupString(line
            .Replace(" at ", "<span class='method'> at </span>")
            .Replace(" in ", " <span class='file'>in </span>")
            .Replace(":line", " <span class='line'>:line</span>"));
    }
}
